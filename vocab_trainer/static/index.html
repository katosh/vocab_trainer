<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vocab Trainer</title>
    <link rel="stylesheet" href="/style.css">
</head>
<body>
    <div id="app">
        <header>
            <h1>Vocab Trainer</h1>
            <nav>
                <button class="nav-btn active" data-view="dashboard">Dashboard</button>
                <button class="nav-btn" data-view="quiz">Quiz</button>
                <button class="nav-btn" data-view="settings">Settings</button>
            </nav>
        </header>

        <!-- Dashboard View -->
        <section id="view-dashboard" class="view active">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="stat-total">—</div>
                    <div class="stat-label">Words / Clusters</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="stat-due">—</div>
                    <div class="stat-label">Due Now</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="stat-reviewed">—</div>
                    <div class="stat-label">Reviewed</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="stat-accuracy">—</div>
                    <div class="stat-label">Accuracy</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="stat-sessions">—</div>
                    <div class="stat-label">Sessions</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="stat-active">—</div>
                    <div class="stat-label">Active Words</div>
                </div>
            </div>

            <div class="actions">
                <button id="btn-start-session" class="btn-primary btn-large">Start Session</button>
                <button id="btn-import" class="btn-secondary">Import Vocabulary</button>
                <button id="btn-generate" class="btn-secondary">Generate Questions</button>
            </div>

            <!-- Session gate panel (shown when active words cap blocks new words) -->
            <div id="session-gate" class="session-gate hidden">
                <p id="gate-summary" class="gate-summary"></p>
                <div class="gate-slider-row">
                    <label for="gate-slider">Max Active Words</label>
                    <input type="range" id="gate-slider" min="0" max="100" value="20">
                    <span id="gate-slider-val">20</span>
                </div>
                <p id="gate-result" class="gate-result"></p>
                <div class="gate-actions">
                    <button id="gate-start" class="btn-primary">Start Session</button>
                    <button id="gate-cancel" class="btn-secondary">Cancel</button>
                </div>
            </div>

            <div id="dashboard-message" class="message hidden"></div>
        </section>

        <!-- Quiz View -->
        <section id="view-quiz" class="view">
            <!-- Pre-quiz state -->
            <div id="quiz-idle" class="quiz-state">
                <p>Start a session from the Dashboard to begin.</p>
            </div>

            <!-- Loading state -->
            <div id="quiz-loading" class="quiz-state hidden">
                <div class="spinner"></div>
                <p id="quiz-loading-text">Loading question...</p>
            </div>

            <!-- Question state -->
            <div id="quiz-question" class="quiz-state hidden">
                <div class="progress-bar-container">
                    <div class="progress-bar" id="progress-bar"></div>
                </div>
                <div class="progress-text" id="progress-text"></div>

                <div class="question-card">
                    <div class="question-meta">
                        <div class="question-type" id="question-type"></div>
                        <div class="question-badge" id="question-badge"></div>
                    </div>
                    <div class="cluster-title" id="cluster-title"></div>
                    <div class="question-stem" id="question-stem"></div>

                    <div class="choices" id="choices"></div>
                </div>

                <div id="answer-reveal" class="answer-reveal hidden">
                    <div class="result-icon" id="result-icon"></div>
                    <div class="explanation" id="explanation"></div>
                    <div class="context-sentence" id="context-sentence"></div>
                    <div class="choice-details" id="choice-details"></div>
                    <div class="archive-status hidden" id="archive-status">
                        <span class="archive-text" id="archive-text"></span>
                        <button class="archive-toggle-btn" id="archive-toggle"></button>
                    </div>
                    <audio id="tts-audio" hidden></audio>

                    <!-- Word chat (LLM tutor) -->
                    <div class="word-chat" id="word-chat">
                        <div class="chat-quick-buttons">
                            <div class="chat-button-row">
                                <button class="chat-btn" data-action="compare">Compare all choices</button>
                                <div class="complexity-selector" id="complexity-selector">
                                    <span class="complexity-label">Context level:</span>
                                    <button class="complexity-btn active" data-level="simple">Simple</button>
                                    <button class="complexity-btn" data-level="intermediate">Intermediate</button>
                                    <button class="complexity-btn" data-level="advanced">Advanced</button>
                                </div>
                            </div>
                        </div>
                        <div class="chat-messages" id="chat-messages"></div>
                        <div class="chat-input-row">
                            <input type="text" id="chat-input" placeholder="Ask about these words..." autocomplete="off" data-1p-ignore>
                            <button id="chat-send" class="chat-send-btn">Send</button>
                        </div>
                    </div>

                    <button id="btn-next" class="btn-primary">Next Question</button>
                </div>
            </div>

            <!-- Session complete state -->
            <div id="quiz-summary" class="quiz-state hidden">
                <h2>Session Complete</h2>
                <div class="summary-stats">
                    <div class="summary-item">
                        <span class="summary-value" id="summary-total">0</span>
                        <span class="summary-label">Questions</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-value" id="summary-correct">0</span>
                        <span class="summary-label">Correct</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-value" id="summary-accuracy">0%</span>
                        <span class="summary-label">Accuracy</span>
                    </div>
                </div>
                <div class="summary-breakdown hidden" id="summary-breakdown"></div>
                <button id="btn-new-session" class="btn-primary btn-large">New Session</button>
                <button id="btn-back-dashboard" class="btn-secondary">Back to Dashboard</button>
            </div>
        </section>

        <!-- Settings View -->
        <section id="view-settings" class="view">
            <h2>Settings</h2>
            <form id="settings-form" data-1p-ignore>
                <div class="form-group">
                    <label for="set-llm">LLM Provider</label>
                    <select id="set-llm">
                        <option value="ollama">Ollama (local)</option>
                        <option value="anthropic">Anthropic (Claude)</option>
                        <option value="openai">OpenAI</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="set-llm-model">LLM Model</label>
                    <input id="set-llm-model" type="text" value="qwen3:8b" autocomplete="off" data-1p-ignore>
                </div>
                <div class="form-group">
                    <label for="set-tts">TTS Provider</label>
                    <select id="set-tts">
                        <option value="edge-tts">Edge TTS (free)</option>
                        <option value="elevenlabs">ElevenLabs</option>
                        <option value="piper">Piper (offline)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="set-tts-voice">TTS Voice</label>
                    <input id="set-tts-voice" type="text" value="en-US-GuyNeural" autocomplete="off" data-1p-ignore>
                </div>
                <div class="form-group">
                    <label for="set-session-size">Session Size</label>
                    <input id="set-session-size" type="range" min="5" max="50" value="20">
                    <span id="set-session-size-val">20</span>
                    <small class="form-hint">Total questions per session (reviews + new words)</small>
                </div>
                <div class="form-group">
                    <label for="set-min-ready">Min Ready Questions (auto-generate buffer)</label>
                    <input id="set-min-ready" type="range" min="0" max="20" value="3">
                    <span id="set-min-ready-val">3</span>
                </div>
                <div class="form-group">
                    <label for="set-max-active">Max Active Words</label>
                    <input id="set-max-active" type="range" min="5" max="100" value="20">
                    <span id="set-max-active-val">20</span>
                    <small class="form-hint">Stop introducing new words when this many are in rotation</small>
                </div>
                <div class="form-group">
                    <label for="set-archive-interval">Archive Interval (days)</label>
                    <input id="set-archive-interval" type="range" min="7" max="90" value="21">
                    <span id="set-archive-interval-val">21</span>
                    <small class="form-hint">Words graduate when their SRS interval reaches this many days</small>
                </div>
                <button type="submit" class="btn-primary">Save Settings</button>
                <div id="settings-message" class="message hidden"></div>
            </form>
        </section>
    </div>

    <script src="/app.js"></script>
</body>
</html>
