# Vocab Trainer

Interactive vocabulary training app that generates context-rich multiple-choice questions from near-synonym clusters, voices correct answers via TTS, and tracks progress with spaced repetition.

Built on ~1,860 words parsed from `vocabulary.md` (1,355 words across 38 categories) and `vocabulary_distinctions.md` (107 near-synonym clusters with nuanced distinctions).

## Quick Start

```bash
cd vocab_trainer

# 1. Import vocabulary into SQLite
uv run python -m vocab_trainer import

# 2. Start Ollama + pull a model (one-time setup)
brew install ollama          # macOS
ollama serve &               # start the server
ollama pull qwen3:8b         # ~5 GB download

# 3. Pre-generate questions
uv run python -m vocab_trainer generate --count 20

# 4. Launch the web UI
uv run python -m vocab_trainer serve
# Open http://localhost:8765
```

You can also import and generate questions from the web UI's Dashboard view.

## CLI Commands

| Command | Description |
|---------|-------------|
| `uv run python -m vocab_trainer import` | Parse vocabulary markdown files into SQLite |
| `uv run python -m vocab_trainer generate --count N` | Pre-generate N questions using the configured LLM |
| `uv run python -m vocab_trainer serve --port PORT` | Launch web app (default port 8765) |
| `uv run python -m vocab_trainer stats` | Print progress summary to terminal |

## How It Works

### Question Types

Questions are generated by an LLM from the distinction clusters:

- **Fill in the Blank** (60%) — A context sentence with one blank; 4 choices from the same cluster. Tests contextual fitness.
- **Best Fit** (25%) — A short scenario; pick the word that best applies. Tests shade of meaning.
- **Distinction** (15%) — "Which word specifically implies X?" Tests explicit knowledge of near-synonym differences.

### Spaced Repetition (SM-2)

Each word tracks an easiness factor, interval, and repetition count. After each answer:

- **Correct**: interval grows (1d -> 6d -> interval * EF)
- **Wrong**: interval resets to 1 day
- Response time maps to a quality score (instant = 5, slow = 3, wrong = 1)

Sessions prioritize overdue words first, then introduce new words up to a configurable limit.

### Keyboard Shortcuts

During a quiz session:

- **A/B/C/D** or **1/2/3/4** — Select an answer
- **Enter** or **Space** — Next question (after answer reveal)

## Architecture

```
vocab_trainer/
├── pyproject.toml
├── config.json                  # Provider settings, session params
├── vocab_trainer/
│   ├── __main__.py              # CLI entry point
│   ├── app.py                   # FastAPI routes + session management
│   ├── config.py                # Settings dataclass, load/save config.json
│   ├── models.py                # Core dataclasses (VocabWord, Question, etc.)
│   ├── db.py                    # SQLite schema + CRUD
│   ├── srs.py                   # SM-2 spaced repetition
│   ├── question_generator.py    # LLM orchestration + JSON validation
│   ├── prompts.py               # Prompt templates per question type
│   ├── audio.py                 # TTS caching (hash-based)
│   ├── parsers/
│   │   ├── vocabulary_parser.py       # Parse vocabulary.md
│   │   └── distinctions_parser.py     # Parse vocabulary_distinctions.md
│   ├── providers/
│   │   ├── base.py              # ABCs: LLMProvider, TTSProvider
│   │   ├── llm_ollama.py        # Ollama (Qwen3) via httpx
│   │   ├── llm_anthropic.py     # Claude API
│   │   ├── llm_openai.py        # OpenAI API
│   │   ├── tts_edge.py          # edge-tts (free, default)
│   │   ├── tts_elevenlabs.py    # ElevenLabs API
│   │   └── tts_piper.py         # Piper (fully offline)
│   └── static/
│       ├── index.html
│       ├── style.css
│       └── app.js
├── audio_cache/                 # Generated TTS files (gitignored)
└── progress.db                  # SQLite database (gitignored)
```

## Provider Configuration

All providers are swappable via `config.json` or the Settings page in the web UI.

### LLM Providers

| Provider | Config value | Requirements |
|----------|-------------|--------------|
| Ollama (default) | `"ollama"` | `ollama serve` running locally, model pulled |
| Anthropic | `"anthropic"` | `ANTHROPIC_API_KEY` env var |
| OpenAI | `"openai"` | `OPENAI_API_KEY` env var |

```bash
# Switch to Claude
uv run python -c "
from vocab_trainer.config import load_settings, save_settings
s = load_settings()
s.llm_provider = 'anthropic'
save_settings(s)
"
```

### TTS Providers

| Provider | Config value | Requirements |
|----------|-------------|--------------|
| Edge TTS (default) | `"edge-tts"` | None (free Microsoft voices) |
| ElevenLabs | `"elevenlabs"` | `ELEVEN_LABS_API_KEY` env var, `uv pip install elevenlabs` |
| Piper | `"piper"` | `piper` binary on PATH |

### config.json Reference

| Key | Default | Description |
|-----|---------|-------------|
| `llm_provider` | `"ollama"` | LLM backend |
| `llm_model` | `"qwen3:8b"` | Model name (Ollama model or API model) |
| `tts_provider` | `"edge-tts"` | TTS backend |
| `tts_voice` | `"en-US-GuyNeural"` | Voice ID for edge-tts |
| `elevenlabs_voice_id` | `"lfBVYbXnblkOddWFfEIg"` | ElevenLabs voice |
| `session_size` | `20` | Questions per session |
| `new_words_per_session` | `10` | Max new (unreviewed) words per session |
| `vocab_files` | `["../vocabulary.md", ...]` | Paths to vocabulary source files |
| `ollama_url` | `"http://localhost:11434"` | Ollama API endpoint |

## Running Tests

```bash
cd vocab_trainer
uv run --extra all python -m pytest tests/ -v
```

## API Endpoints

| Method | Path | Description |
|--------|------|-------------|
| `GET` | `/` | Serve web UI |
| `GET` | `/api/stats` | Dashboard data |
| `POST` | `/api/import` | Re-parse vocab files into DB |
| `POST` | `/api/generate` | Trigger batch question generation |
| `POST` | `/api/session/start` | Begin quiz session, return first question |
| `POST` | `/api/session/answer` | Submit answer, get result + next question |
| `POST` | `/api/session/next` | Get next question in session |
| `GET` | `/api/session/summary` | Session history |
| `GET` | `/api/audio/{hash}.mp3` | Serve cached TTS audio |
| `GET` | `/api/settings` | Current config |
| `PUT` | `/api/settings` | Update provider/session settings |
